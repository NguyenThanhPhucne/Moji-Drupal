{#
/**
 * @file
 * Professional User Management Template.
 *
 * Available variables:
 * - users: Array of user objects with enriched data
 * - stats: Summary statistics
 */
#}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="chat-admin-users">
  {# Page Header #}
  <div class="page-header">
    <div>
      <h1><i class="fas fa-users"></i> {{ 'User Management'|t }}</h1>
      <p class="subtitle">{{ 'Manage and monitor all chat users'|t }}</p>
    </div>
    <div class="header-actions">
      <a href="/admin/chat" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> {{ 'Back to Dashboard'|t }}
      </a>
    </div>
  </div>

  {# Summary Statistics #}
  <div class="users-stats">
    <div class="stat-box">
      <i class="fas fa-users stat-icon"></i>
      <div class="stat-content">
        <div class="stat-value">{{ stats.total_users }}</div>
        <div class="stat-label">{{ 'Total Users'|t }}</div>
      </div>
    </div>
    <div class="stat-box">
      <i class="fas fa-user-check stat-icon stat-icon--success"></i>
      <div class="stat-content">
        <div class="stat-value">{{ stats.active_today }}</div>
        <div class="stat-label">{{ 'Active Today'|t }}</div>
      </div>
    </div>
    <div class="stat-box">
      <i class="fas fa-calendar-week stat-icon stat-icon--info"></i>
      <div class="stat-content">
        <div class="stat-value">{{ stats.active_week }}</div>
        <div class="stat-label">{{ 'Active This Week'|t }}</div>
      </div>
    </div>
    <div class="stat-box">
      <i class="fas fa-user-slash stat-icon stat-icon--danger"></i>
      <div class="stat-content">
        <div class="stat-value">{{ stats.blocked_users }}</div>
        <div class="stat-label">{{ 'Blocked Users'|t }}</div>
      </div>
    </div>
  </div>

  {# Users Table #}
  <div class="table-container">
    <div class="table-header">
      <h2><i class="fas fa-list"></i> {{ 'All Users'|t }}</h2>
      <div class="table-actions">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="userSearch" placeholder="{{ 'Search users...'|t }}">
        </div>
        <select id="statusFilter" class="filter-select">
          <option value="all">{{ 'All Status'|t }}</option>
          <option value="active">{{ 'Active Only'|t }}</option>
          <option value="blocked">{{ 'Blocked Only'|t }}</option>
        </select>
      </div>
    </div>

    {% if users|length > 0 %}
      <div class="table-responsive">
        <table class="users-table">
          <thead>
            <tr>
              <th><i class="fas fa-hashtag"></i> {{ 'ID'|t }}</th>
              <th><i class="fas fa-user"></i> {{ 'User'|t }}</th>
              <th><i class="fas fa-envelope"></i> {{ 'Email'|t }}</th>
              <th><i class="fas fa-user-friends"></i> {{ 'Friends'|t }}</th>
              <th><i class="fas fa-clock"></i> {{ 'Requests'|t }}</th>
              <th><i class="far fa-calendar"></i> {{ 'Registered'|t }}</th>
              <th><i class="fas fa-sign-in-alt"></i> {{ 'Last Access'|t }}</th>
              <th><i class="fas fa-toggle-on"></i> {{ 'Status'|t }}</th>
              <th><i class="fas fa-cog"></i> {{ 'Actions'|t }}</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr class="user-row" data-status="{{ user.status ? 'active' : 'blocked' }}" data-uid="{{ user.uid }}">
                <td class="user-id">
                  <strong>#{{ user.uid }}</strong>
                </td>
                <td class="user-info">
                  <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                  </div>
                  <div class="user-details">
                    <a href="/admin/chat/users/{{ user.uid }}" class="user-name">{{ user.name }}</a>
                    <div class="user-meta">
                      {{ user.days_registered }} {{ 'days ago'|t }}
                    </div>
                  </div>
                </td>
                <td class="user-email">
                  <i class="fas fa-envelope"></i> {{ user.mail }}
                </td>
                <td class="text-center">
                  <span class="badge badge-info">
                    <i class="fas fa-user-friends"></i> {{ user.friend_count }}
                  </span>
                </td>
                <td class="text-center">
                  {% if user.pending_requests > 0 %}
                    <span class="badge badge-warning">
                      <i class="fas fa-clock"></i> {{ user.pending_requests }}
                    </span>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td class="user-date">
                  <i class="far fa-calendar-alt"></i>
                  {{ user.created|date('M d, Y') }}
                  <div class="date-time">{{ user.created|date('H:i') }}</div>
                </td>
                <td class="user-date">
                  {% if user.access > 0 %}
                    <i class="fas fa-sign-in-alt"></i>
                    {{ user.access|date('M d, Y') }}
                    <div class="date-time">
                      {% if user.days_since_access == 0 %}
                        <span class="text-success">{{ 'Today'|t }}</span>
                      {% elseif user.days_since_access == 1 %}
                        {{ 'Yesterday'|t }}
                      {% else %}
                        {{ user.days_since_access }} {{ 'days ago'|t }}
                      {% endif %}
                    </div>
                  {% else %}
                    <span class="text-muted">{{ 'Never'|t }}</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if user.status == 1 %}
                    <span class="status-badge status-active">
                      <i class="fas fa-check-circle"></i> {{ 'Active'|t }}
                    </span>
                  {% else %}
                    <span class="status-badge status-blocked">
                      <i class="fas fa-ban"></i> {{ 'Blocked'|t }}
                    </span>
                  {% endif %}
                </td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <a href="/admin/chat/users/{{ user.uid }}" class="btn-action btn-view" title="{{ 'View Profile'|t }}">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/user/{{ user.uid }}/edit" class="btn-action btn-edit" title="{{ 'Edit User'|t }}">
                      <i class="fas fa-edit"></i>
                    </a>
                    {% if user.status == 1 %}
                      <button class="btn-action btn-danger action-block" data-uid="{{ user.uid }}" data-status="active" title="{{ 'Block User'|t }}">
                        <i class="fas fa-ban"></i>
                      </button>
                    {% else %}
                      <button class="btn-action btn-success action-unblock" data-uid="{{ user.uid }}" data-status="blocked" title="{{ 'Unblock User'|t }}">
                        <i class="fas fa-check"></i>
                      </button>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {# Pagination will be rendered here by Drupal #}
      <div class="table-footer">
        <div class="table-info">
          <i class="fas fa-info-circle"></i>
          {{ 'Showing'|t }} <strong>{{ users|length }}</strong> {{ 'users per page'|t }}
        </div>
      </div>
    {% else %}
      <div class="empty-state">
        <i class="fas fa-users-slash"></i>
        <h3>{{ 'No Users Found'|t }}</h3>
        <p>{{ 'There are no users matching your criteria.'|t }}</p>
      </div>
    {% endif %}
  </div>
</div>
