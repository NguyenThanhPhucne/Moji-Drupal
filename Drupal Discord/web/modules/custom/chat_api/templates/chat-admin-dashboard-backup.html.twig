{#
/**
 * @file
 * Theme template for Chat Admin Dashboard.
 *
 * Available variables:
 * - stats: Array of statistics
 *   - total_users: Total number of users
 *   - active_users_today: Active users today
 *   - active_users_week: Active users this week
 *   - total_friends: Total friendships
 *   - pending_requests: Pending friend requests
 *   - new_users_today: New users today
 *   - new_users_week: New users this week
 *   - blocked_users: Blocked users count
 * - activity_trends: Array of activity data for charts
 * - recent_stats: Recent users and friend requests
 * - system_health: System health information
 */
#}

<div class="chat-admin-dashboard">
  <div class="dashboard-header">
    <h1>{{ 'Chat Administration'|t }}</h1>
    <p class="dashboard-description">{{ 'Comprehensive system overview and statistics'|t }}</p>
  </div>

  {# Main Statistics Grid #}
  <div class="stats-section">
    <h2 class="section-title">{{ 'System Overview'|t }}</h2>
    <div class="stats-grid">
      {# Total Users #}
      <div class="stat-card stat-card--users">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.total_users }}</div>
          <div class="stat-label">{{ 'Total Users'|t }}</div>
          <div class="stat-meta">
            <span class="badge badge-success">+{{ stats.new_users_today }} {{ 'today'|t }}</span>
            <span class="badge badge-info">+{{ stats.new_users_week }} {{ 'this week'|t }}</span>
          </div>
        </div>
        <a href="/admin/chat/users" class="stat-link">{{ 'Manage users â†’'|t }}</a>
      </div>
      
      {# Active Users #}
      <div class="stat-card stat-card--active">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.active_users_today }}</div>
          <div class="stat-label">{{ 'Active Today'|t }}</div>
          <div class="stat-meta">
            <span class="badge badge-primary">{{ stats.active_users_week }} {{ 'this week'|t }}</span>
            {% set active_percentage = stats.total_users > 0 ? (stats.active_users_today / stats.total_users * 100)|round(1) : 0 %}
            <span class="badge badge-secondary">{{ active_percentage }}% {{ 'rate'|t }}</span>
          </div>
        </div>
        <a href="/admin/chat/reports/users" class="stat-link">{{ 'View activity â†’'|t }}</a>
      </div>
      
      {# Friendships #}
      <div class="stat-card stat-card--friends">
        <div class="stat-icon">ğŸ¤</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.total_friends }}</div>
          <div class="stat-label">{{ 'Total Friendships'|t }}</div>
          <div class="stat-meta">
            {% set avg_friends = stats.total_users > 0 ? (stats.total_friends / stats.total_users)|round(1) : 0 %}
            <span class="badge badge-info">{{ avg_friends }} {{ 'avg per user'|t }}</span>
          </div>
        </div>
        <a href="/admin/chat/friend-requests" class="stat-link">{{ 'View details â†’'|t }}</a>
      </div>
      
      {# Pending Requests #}
      <div class="stat-card stat-card--pending">
        <div class="stat-icon">â³</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.pending_requests }}</div>
          <div class="stat-label">{{ 'Pending Requests'|t }}</div>
          <div class="stat-meta">
            {% if stats.pending_requests > 10 %}
              <span class="badge badge-warning">{{ 'High volume'|t }}</span>
            {% else %}
              <span class="badge badge-success">{{ 'Normal'|t }}</span>
            {% endif %}
          </div>
        </div>
        <a href="/admin/chat/friend-requests" class="stat-link">{{ 'Review requests â†’'|t }}</a>
      </div>
    </div>
  </div>

  {# Secondary Stats #}
  <div class="secondary-stats">
    <div class="stat-item">
      <span class="stat-item-label">{{ 'Blocked Users'|t }}:</span>
      <span class="stat-item-value">{{ stats.blocked_users }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-item-label">{{ 'System Health'|t }}:</span>
      <span class="stat-item-value">
        <span class="status-indicator status-ok"></span> {{ system_health.database_status }}
      </span>
    </div>
    <div class="stat-item">
      <span class="stat-item-label">{{ 'Total Records'|t }}:</span>
      <span class="stat-item-value">{{ system_health.total_records|number_format }}</span>
    </div>
  </div>

  {# Activity Charts #}
  <div class="dashboard-charts">
    <h2 class="section-title">{{ 'Activity Trends (Last 7 Days)'|t }}</h2>
    <div class="charts-grid">
      <div class="chart-card">
        <h3>{{ 'New Users'|t }}</h3>
        <canvas id="newUsersChart" width="400" height="200"></canvas>
        <div class="chart-summary">
          <span class="trend-up">â†‘ {{ stats.new_users_week }} {{ 'this week'|t }}</span>
        </div>
      </div>
      
      <div class="chart-card">
        <h3>{{ 'Active Users'|t }}</h3>
        <canvas id="activeUsersChart" width="400" height="200"></canvas>
        <div class="chart-summary">
          <span class="trend-info">â†’ {{ stats.active_users_week }} {{ 'this week'|t }}</span>
        </div>
      </div>

      <div class="chart-card">
        <h3>{{ 'Friend Requests'|t }}</h3>
        <canvas id="friendRequestsChart" width="400" height="200"></canvas>
        <div class="chart-summary">
          <span class="trend-neutral">{{ 'Normal activity'|t }}</span>
        </div>
      </div>
    </div>
  </div>

  {# Recent Activity #}
  <div class="recent-activity">
    <div class="activity-section">
      <h2 class="section-title">{{ 'Recent Users'|t }}</h2>
      {% if recent_stats.recent_users is not empty %}
        <div class="activity-list">
          {% for user in recent_stats.recent_users %}
            <div class="activity-item">
              <div class="activity-avatar">
                {{ user.name|first|upper }}
              </div>
              <div class="activity-content">
                <div class="activity-name">
                  <a href="/admin/chat/users/{{ user.uid }}">{{ user.name }}</a>
                  {% if user.status == 0 %}
                    <span class="badge badge-danger">{{ 'Blocked'|t }}</span>
                  {% endif %}
                </div>
                <div class="activity-meta">
                  {{ user.mail }} â€¢ {{ 'Joined'|t }} {{ user.created|date('M d, Y') }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <a href="/admin/chat/users" class="view-all-link">{{ 'View all users â†’'|t }}</a>
      {% else %}
        <p class="empty-message">{{ 'No recent users'|t }}</p>
      {% endif %}
    </div>

    <div class="activity-section">
      <h2 class="section-title">{{ 'Recent Friend Requests'|t }}</h2>
      {% if recent_stats.recent_requests is not empty %}
        <div class="activity-list">
          {% for request in recent_stats.recent_requests %}
            <div class="activity-item">
              <div class="activity-icon">ğŸ¤</div>
              <div class="activity-content">
                <div class="activity-name">
                  <strong>{{ request.sender_name }}</strong> â†’ {{ request.receiver_name }}
                </div>
                <div class="activity-meta">
                  <span class="badge badge-info">{{ 'Pending'|t }}</span>
                  {{ request.created|date('M d, H:i') }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <a href="/admin/chat/friend-requests" class="view-all-link">{{ 'View all requests â†’'|t }}</a>
      {% else %}
        <p class="empty-message">{{ 'No recent requests'|t }}</p>
      {% endif %}
    </div>
  </div>

  {# Quick Actions #}
  <div class="quick-actions">
    <h2 class="section-title">{{ 'Quick Actions'|t }}</h2>
    <div class="action-links">
      <a href="/admin/chat/users" class="action-button action-button--primary">
        <span class="action-icon">ğŸ‘¤</span>
        <span class="action-text">{{ 'Manage Users'|t }}</span>
      </a>
      
      <a href="/admin/chat/conversations" class="action-button action-button--secondary">
        <span class="action-icon">ğŸ’¬</span>
        <span class="action-text">{{ 'View Conversations'|t }}</span>
      </a>
      
      <a href="/admin/chat/reports" class="action-button action-button--info">
        <span class="action-icon">ğŸ“Š</span>
        <span class="action-text">{{ 'View Reports'|t }}</span>
      </a>
      
      <a href="/admin/chat/settings" class="action-button action-button--warning">
        <span class="action-icon">âš™ï¸</span>
        <span class="action-text">{{ 'System Settings'|t }}</span>
      </a>
    </div>
  </div>

</div>

{# Add Chart.js CDN #}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
